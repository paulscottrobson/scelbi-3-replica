 AS V1.42 Beta [Bld 102] - source file test.asm - page 1 - 10/14/2015 19:29:03


       1/       0 :                     	
       2/       0 :                     		cpu		8008new
       3/       0 :                     		org 	0
       4/       0 :                     
       5/       0 : 36 00               		mvi 	l,0
       6/       2 : 46 42 01            Start:	call	RepaintScreen
       7/       5 :                     
       8/       5 : 45                  Wait:	in 		2
       9/       6 : B0                  		ora 	a
      10/       7 : 50 05 00            		jp 		Wait
      11/       A : 53                  		out 	9
      12/       B : 24 7F               		ani	 	7Fh
      13/       D : 3C 60               		cpi 	60h
      14/       F : 60 14 00            		jc 		NotLC
      15/      12 : 14 20               		sui 	20h
      16/      14 :                     NotLC:
      17/      14 : 2E 01               		mvi 	h,ScreenMap/256
      18/      16 : F8                  		mov 	m,a
      19/      17 : 30                  		inr 	l
      20/      18 : C6                  		mov 	a,l
      21/      19 : 24 3F               		ani 	63
      22/      1B : F0                  		mov 	l,a
      23/      1C : 44 02 00            		jmp 	Start
      24/      1F :                     
      25/      1F :                     ; ********************************************************************************************************************************
      26/      1F :                     ; ********************************************************************************************************************************
      27/      1F :                     ;
      28/      1F :                     ;		This 256 byte block contains the screen refresh code, the memory for the screen and the code to repaint it to the
      29/      1F :                     ;		Scope display.
      30/      1F :                     ;
      31/      1F :                     ; ********************************************************************************************************************************
      32/      1F :                     ; ********************************************************************************************************************************
      33/      1F :                     
      34/      1F :                     		align 	256
      35/     100 :                     
      36/     100 :                     ; ********************************************************************************************************************************
      37/     100 :                     ;
      38/     100 :                     ;							This routine is ROMmable but the ScreenMap and _RSRestore must be in RAM.
      39/     100 :                     ;
      40/     100 :                     ; ********************************************************************************************************************************
      41/     100 :                     
      42/     100 :                     ScreenMap: 														; this can move, but must be on a 16 byte boundary.
      43/     100 : 30 30 30 30 30 30   		db 		"00000000 COUNTER" 								; if _RSLineCount is increased beyond 4, this driver will not fit
                    30 30 20 43 4F 55 
                    4E 54 45 52 
      44/     110 : 48 45 4C 4C 4F 20   		db 		"HELLO WORLD     "								; in 1/4 k of RAM.
                    57 4F 52 4C 44 20 
                    20 20 20 20 
      45/     120 : 2A 2A 2A 20 20 4C   		db 		"***  LINE 3  ***"
                    49 4E 45 20 33 20 
                    20 2A 2A 2A 
      46/     130 : 45 4E 44 20 4F 46   		db 		"END OF PAGE     "
                    20 50 41 47 45 20 
                    20 20 20 20 
      47/     140 :                     
      48/     140 :                     _RSRestore:														; HL is saved here.
      49/     140 : 00 00               		dw 		0
      50/     142 :                     
      51/     142 : =4H                 _RSLineCount = 4 												; number of display lines, note if more than 4 the ScreenMap must move.
      52/     142 : =EH                 _RSLowScopePort = 0Eh 											; output port low
 AS V1.42 Beta [Bld 102] - source file test.asm - page 2 - 10/14/2015 19:29:03


      53/     142 : =FH                 _RSHighScopePort = 0Fh											; output port high and start
      54/     142 : =55H                _RSNewLineCommand = 55h 										; code for new line.
      55/     142 :                     
      56/     142 :                     ; ********************************************************************************************************************************
      57/     142 :                     ;
      58/     142 :                     ;												Repaint the screen. Breaks AE.
      59/     142 :                     ;
      60/     142 :                     ; ********************************************************************************************************************************
      61/     142 :                     
      62/     142 :                     RepaintScreen:
      63/     142 : E6                  		mov 	e,l 											; save HL to AE
      64/     143 : C5                  		mov		a,h
      65/     144 : 2E 01               		mvi 	h,_RSRestore/256 								; point HL to the HL store.
      66/     146 : 36 40               		mvi 	l,_RSRestore & 255 	
      67/     148 : FC                  		mov 	m,e 											; save L (in E) then H (in A) there
      68/     149 : 30                  		inr 	l
      69/     14A : F8                  		mov 	m,a
      70/     14B : A8                  		xra 	a 												; write $00 to the scope, which sets B7, homes the cursor
      71/     14C : 5D                  		out 	_RSLowScopePort 	
      72/     14D : 5F                  		out		_RSHighScopePort
      73/     14E :                     
      74/     14E : 26 00               		mvi 	e,ScreenMap&255 								; this is where we are drawing from.
      75/     150 :                     _RSRenderLoop:
      76/     150 : 2E 01               		mvi 	h,ScreenMap/256 								; point HL to screen map
      77/     152 : F4                  		mov 	l,e 
      78/     153 : C7                  		mov 	a,m 											; read character
      79/     154 : 24 3F               		ani 	03Fh											; 6 bit ASCII
      80/     156 : 80                  		add 	a 												; double
      81/     157 : 04 80               		adi 	_RSFont & 255 									; point HL to font data
      82/     159 : F0                  		mov 	l,a
      83/     15A : 2E 01               		mvi 	h,_RSFont/256
      84/     15C : C7                  		mov 	a,m 											; output data.
      85/     15D : 5D                  		out 	_RSLowScopePort
      86/     15E : 30                  		inr 	l
      87/     15F : C7                  		mov 	a,m
      88/     160 : 5F                  		out 	_RSHighScopePort
      89/     161 : 20                  		inr 	e 												; next address
      90/     162 : C4                  		mov 	a,e 											; reached EOL e.g. xxxx0000
      91/     163 : 24 0F               		ani 	0Fh
      92/     165 : 48 50 01            		jnz 	_RSRenderLoop
      93/     168 : 06 55               		mvi 	a,_RSNewLineCommand								; output $5555 with bit 15 set, for a new line.
      94/     16A : 5D                  		out 	_RSLowScopePort
      95/     16B : 06 D5               		mvi 	a,_RSNewLineCommand!80h
      96/     16D : 5F                  		out 	_RSHighScopePort
      97/     16E : C4                  		mov 	a,e
      98/     16F : 2C 40               		xri 	(ScreenMap&255)+(_RSLineCount*16) 				; reached the end of the map.
      99/     171 : 48 50 01            		jnz 	_RSRenderLoop
     100/     174 :                     
     101/     174 : 2E 01               		mvi 	h,_RSRestore/256 								; point HL to the HL store.
     102/     176 : 36 40               		mvi 	l,_RSRestore & 255 	
     103/     178 : C7                  		mov 	a,m
     104/     179 : 30                  		inr 	l
     105/     17A : EF                  		mov 	h,m
     106/     17B : F0                  		mov 	l,a
     107/     17C : 07                  		ret
     108/     17D :                     
     109/     17D :                     		align 	128
     110/     180 :                     ; ********************************************************************************************************************************
     111/     180 :                     ;
     112/     180 :                     ;										64 x 2 byte font entries, one for each character
 AS V1.42 Beta [Bld 102] - source file test.asm - page 3 - 10/14/2015 19:29:03


     113/     180 :                     ;
     114/     180 :                     ; ********************************************************************************************************************************
     115/     180 :                     
     116/     180 :                     _RSFont:	
     117/     180 :                     		include __starburst.inc
(1)    1/     180 : FF 9A                       dw 39679
(1)    2/     182 : 1F E0                       dw 57375
(1)    3/     184 : 7C E4                       dw 58492
(1)    4/     186 : 67 80                       dw 32871
(1)    5/     188 : 7C 84                       dw 33916
(1)    6/     18A : 67 A0                       dw 41063
(1)    7/     18C : 07 E0                       dw 57351
(1)    8/     18E : 77 C0                       dw 49271
(1)    9/     190 : 1B E0                       dw 57371
(1)   10/     192 : 64 84                       dw 33892
(1)   11/     194 : 79 80                       dw 32889
(1)   12/     196 : 03 AA                       dw 43523
(1)   13/     198 : 63 80                       dw 32867
(1)   14/     19A : 1B 92                       dw 37403
(1)   15/     19C : 1B 98                       dw 38939
(1)   16/     19E : 7F 80                       dw 32895
(1)   17/     1A0 : 0F E0                       dw 57359
(1)   18/     1A2 : 7F 88                       dw 34943
(1)   19/     1A4 : 0F E8                       dw 59407
(1)   20/     1A6 : 74 D0                       dw 53364
(1)   21/     1A8 : 04 84                       dw 33796
(1)   22/     1AA : 7B 80                       dw 32891
(1)   23/     1AC : 83 82                       dw 33411
(1)   24/     1AE : 9B 88                       dw 34971
(1)   25/     1B0 : 80 9A                       dw 39552
(1)   26/     1B2 : 18 D0                       dw 53272
(1)   27/     1B4 : E4 82                       dw 33508
(1)   28/     1B6 : 61 E0                       dw 57441
(1)   29/     1B8 : 00 98                       dw 38912
(1)   30/     1BA : 70 E0                       dw 57456
(1)   31/     1BC : 0E 80                       dw 32782
(1)   32/     1BE : 60 80                       dw 32864
(1)   33/     1C0 : 00 80                       dw 32768
(1)   34/     1C2 : 00 84                       dw 33792
(1)   35/     1C4 : 0A 80                       dw 32778
(1)   36/     1C6 : 78 E4                       dw 58488
(1)   37/     1C8 : 76 E4                       dw 58486
(1)   38/     1CA : 92 82                       dw 33426
(1)   39/     1CC : 65 BA                       dw 47717
(1)   40/     1CE : 08 80                       dw 32776
(1)   41/     1D0 : 67 8A                       dw 35431
(1)   42/     1D2 : FC 90                       dw 37116
(1)   43/     1D4 : 80 9E                       dw 40576
(1)   44/     1D6 : 00 E4                       dw 58368
(1)   45/     1D8 : 80 80                       dw 32896
(1)   46/     1DA : 00 E0                       dw 57344
(1)   47/     1DC : 00 81                       dw 33024
(1)   48/     1DE : 80 82                       dw 33408
(1)   49/     1E0 : FF 82                       dw 33535
(1)   50/     1E2 : 18 82                       dw 33304
(1)   51/     1E4 : 6D E0                       dw 57453
(1)   52/     1E6 : 7C C0                       dw 49276
(1)   53/     1E8 : 1A E0                       dw 57370
(1)   54/     1EA : 76 E0                       dw 57462
(1)   55/     1EC : 77 E0                       dw 57463
 AS V1.42 Beta [Bld 102] - source file test.asm(__starburst.inc) - page 4 - 10/14/2015 19:29:03


(1)   56/     1EE : 84 82                       dw 33412
(1)   57/     1F0 : 7F E0                       dw 57471
(1)   58/     1F2 : 1E E0                       dw 57374
(1)   59/     1F4 : 40 A0                       dw 41024
(1)   60/     1F6 : 88 80                       dw 32904
(1)   61/     1F8 : 00 8A                       dw 35328
(1)   62/     1FA : 60 E0                       dw 57440
(1)   63/     1FC : 80 90                       dw 36992
(1)   64/     1FE : 0D E0                       dw 57357
 AS V1.42 Beta [Bld 102] - source file test.asm - page 5 - 10/14/2015 19:29:03


  symbol table (* = unused):
  ------------------------

*ARCHITECTURE :  i386-unknown-win32 - | *BIGENDIAN :                      0 - |
*BRANCHEXT :                      0 - | *CASESENSITIVE :                  0 - |
*CONSTPI :        3.141592653589793 - | *DATE :                  10/14/2015 - |
*FALSE :                          0 - | *FULLPMMU :                       1 - |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
*INEXTMODE :                      0 - | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - | *INSRCMODE :                      0 - |
*INSUPMODE :                      0 - | *LISTON :                         1 - |
*MACEXP :                         1 - | *MOMCPU :                     8008E - |
*MOMCPUNAME :               8008NEW - | *NESTMAX :                      100 - |
 NOTLC :                         14 C | *PACKING :                        0 - |
*PADDING :                        1 - | *RELAXED :                        0 - |
 REPAINTSCREEN :                142 C |  SCREENMAP :                    100 C |
 START :                          2 C | *TIME :                    19:29:03 - |
*TRUE :                           1 - | *VERSION :                     142F - |
 WAIT :                           5 C |  _RSFONT :                      180 C |
 _RSHIGHSCOPEPORT :               F - |  _RSLINECOUNT :                   4 - |
 _RSLOWSCOPEPORT :                E - |  _RSNEWLINECOMMAND :             55 - |
 _RSRENDERLOOP :                150 C |  _RSRESTORE :                   140 C |

     40 symbols
     28 unused symbols

 AS V1.42 Beta [Bld 102] - source file test.asm - page 6 - 10/14/2015 19:29:03


  codepages:
  ----------

STANDARD (0 changed characters)


0.01 seconds assembly time

    181 lines source file
      2 passes
      0 errors
      0 warnings
